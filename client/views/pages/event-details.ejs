<!DOCTYPE html>
<html>
<head>
  <%- include ("../partials/header.ejs") %>
  <script>
    $(document).ready(function() {

      var id = getUrlParam('id');
      console.log("Getting event details with id: " + id);

      getEventById(id)
        .then(entry => {
          let row = `
            <div class="row">
              <div class="col-md-6">
                <h3><span class="glyphicon glyphicon-flash"></span> <a href="/event-details?id=${entry.id}">${entry.title}</a></h3>
                <span>Spots: ${entry.spots}</span><br/>
                <span>Registration due date: ${formatDateOf(entry.registrationDueDate)}</span><br/>
                <span>Event date: ${formatDateOf(entry.eventDate)}</span><br/>
                <button id="register-button-${entry.id}">Register</button>
              </div>
              <hr/>
            </div>
          `;

          $(row).appendTo($("#event-details"));

          $('#register-button-' + entry.id).click(function() {
            var eventId = $(this).attr('id').split('-')[2];
            registerForEvent(eventId)
              .then(result => {
                alert("Registered: " + result);
              })
              .catch(err => {
                alert(err);
              });
          });

        });
    });
  </script>
</head>

<body>

  <%- include ("../partials/nav.ejs") %>

  <div class="container">
    <div id="mm-status" class="alert alert-info text-center" role="alert"></div>
    <hr>
    <div id="event-details"></div>

    <%- include ("../partials/footer.ejs") %>

  </div>

</body>
</html>
